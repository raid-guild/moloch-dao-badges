{"ast":null,"code":"'use strict';\n\nconst Wantlist = require('../types/wantlist');\n\nclass Ledger {\n  constructor(peerId) {\n    this.partner = peerId;\n    this.wantlist = new Wantlist();\n    this.exchangeCount = 0;\n    this.sentToPeer = new Map();\n    this.accounting = {\n      bytesSent: 0,\n      bytesRecv: 0\n    };\n  }\n\n  sentBytes(n) {\n    this.exchangeCount++;\n    this.lastExchange = new Date().getTime();\n    this.accounting.bytesSent += n;\n  }\n\n  receivedBytes(n) {\n    this.exchangeCount++;\n    this.lastExchange = new Date().getTime();\n    this.accounting.bytesRecv += n;\n  }\n\n  wants(cid, priority) {\n    this.wantlist.add(cid, priority);\n  }\n\n  cancelWant(cid) {\n    this.wantlist.remove(cid);\n  }\n\n  wantlistContains(cid) {\n    return this.wantlist.contains(cid);\n  }\n\n  debtRatio() {\n    return this.accounting.bytesSent / (this.accounting.bytesRecv + 1); // +1 is to prevent division by zero\n  }\n\n}\n\nmodule.exports = Ledger;","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/ipfs-bitswap/src/decision-engine/ledger.js"],"names":["Wantlist","require","Ledger","constructor","peerId","partner","wantlist","exchangeCount","sentToPeer","Map","accounting","bytesSent","bytesRecv","sentBytes","n","lastExchange","Date","getTime","receivedBytes","wants","cid","priority","add","cancelWant","remove","wantlistContains","contains","debtRatio","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,mBAAD,CAAxB;;AAEA,MAAMC,MAAN,CAAa;AACXC,EAAAA,WAAW,CAAEC,MAAF,EAAU;AACnB,SAAKC,OAAL,GAAeD,MAAf;AACA,SAAKE,QAAL,GAAgB,IAAIN,QAAJ,EAAhB;AAEA,SAAKO,aAAL,GAAqB,CAArB;AACA,SAAKC,UAAL,GAAkB,IAAIC,GAAJ,EAAlB;AAEA,SAAKC,UAAL,GAAkB;AAChBC,MAAAA,SAAS,EAAE,CADK;AAEhBC,MAAAA,SAAS,EAAE;AAFK,KAAlB;AAID;;AAEDC,EAAAA,SAAS,CAAEC,CAAF,EAAK;AACZ,SAAKP,aAAL;AACA,SAAKQ,YAAL,GAAqB,IAAIC,IAAJ,EAAD,CAAaC,OAAb,EAApB;AACA,SAAKP,UAAL,CAAgBC,SAAhB,IAA6BG,CAA7B;AACD;;AAEDI,EAAAA,aAAa,CAAEJ,CAAF,EAAK;AAChB,SAAKP,aAAL;AACA,SAAKQ,YAAL,GAAqB,IAAIC,IAAJ,EAAD,CAAaC,OAAb,EAApB;AACA,SAAKP,UAAL,CAAgBE,SAAhB,IAA6BE,CAA7B;AACD;;AAEDK,EAAAA,KAAK,CAAEC,GAAF,EAAOC,QAAP,EAAiB;AACpB,SAAKf,QAAL,CAAcgB,GAAd,CAAkBF,GAAlB,EAAuBC,QAAvB;AACD;;AAEDE,EAAAA,UAAU,CAAEH,GAAF,EAAO;AACf,SAAKd,QAAL,CAAckB,MAAd,CAAqBJ,GAArB;AACD;;AAEDK,EAAAA,gBAAgB,CAAEL,GAAF,EAAO;AACrB,WAAO,KAAKd,QAAL,CAAcoB,QAAd,CAAuBN,GAAvB,CAAP;AACD;;AAEDO,EAAAA,SAAS,GAAI;AACX,WAAQ,KAAKjB,UAAL,CAAgBC,SAAhB,IAA6B,KAAKD,UAAL,CAAgBE,SAAhB,GAA4B,CAAzD,CAAR,CADW,CAC0D;AACtE;;AAxCU;;AA2CbgB,MAAM,CAACC,OAAP,GAAiB3B,MAAjB","sourcesContent":["'use strict'\n\nconst Wantlist = require('../types/wantlist')\n\nclass Ledger {\n  constructor (peerId) {\n    this.partner = peerId\n    this.wantlist = new Wantlist()\n\n    this.exchangeCount = 0\n    this.sentToPeer = new Map()\n\n    this.accounting = {\n      bytesSent: 0,\n      bytesRecv: 0\n    }\n  }\n\n  sentBytes (n) {\n    this.exchangeCount++\n    this.lastExchange = (new Date()).getTime()\n    this.accounting.bytesSent += n\n  }\n\n  receivedBytes (n) {\n    this.exchangeCount++\n    this.lastExchange = (new Date()).getTime()\n    this.accounting.bytesRecv += n\n  }\n\n  wants (cid, priority) {\n    this.wantlist.add(cid, priority)\n  }\n\n  cancelWant (cid) {\n    this.wantlist.remove(cid)\n  }\n\n  wantlistContains (cid) {\n    return this.wantlist.contains(cid)\n  }\n\n  debtRatio () {\n    return (this.accounting.bytesSent / (this.accounting.bytesRecv + 1)) // +1 is to prevent division by zero\n  }\n}\n\nmodule.exports = Ledger\n"]},"metadata":{},"sourceType":"script"}