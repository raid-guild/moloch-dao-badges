{"ast":null,"code":"'use strict';\n\nconst io = require('orbit-db-io');\n\nconst Buffer = require('safe-buffer/').Buffer;\n\nconst AccessController = require('./access-controller-interface');\n\nconst type = 'legacy-ipfs';\n\nclass LegacyIPFSAccessController extends AccessController {\n  constructor(ipfs, options) {\n    super();\n    this._ipfs = ipfs;\n    this._write = Array.from(options.write || []);\n  } // Returns the type of the access controller\n\n\n  static get type() {\n    return type;\n  } // Return a Set of keys that have `access` capability\n\n\n  get write() {\n    return this._write;\n  }\n\n  async canAppend(entry, identityProvider) {\n    // Allow if access list contain the writer's publicKey or is '*'\n    const publicKey = entry.key;\n\n    if (this.write.includes(publicKey) || this.write.includes('*')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  async load(address) {\n    // Transform '/ipfs/QmPFtHi3cmfZerxtH9ySLdzpg1yFhocYDZgEZywdUXHxFU'\n    // to 'QmPFtHi3cmfZerxtH9ySLdzpg1yFhocYDZgEZywdUXHxFU'\n    if (address.indexOf('/ipfs') === 0) {\n      address = address.split('/')[2];\n    }\n\n    try {\n      const access = await io.read(this._ipfs, address);\n      this._write = access.write;\n    } catch (e) {\n      console.log('LegacyIPFSAccessController.load ERROR:', e);\n    }\n  }\n\n  async save(options) {\n    let cid;\n    const access = {\n      admin: [],\n      write: this.write,\n      read: []\n    };\n\n    try {\n      cid = await io.write(this._ipfs, 'raw', Buffer.from(JSON.stringify(access, null, 2)), {\n        format: 'dag-pb'\n      });\n    } catch (e) {\n      console.log('LegacyIPFSAccessController.save ERROR:', e);\n    } // return the manifest data\n\n\n    return {\n      address: cid,\n      skipManifest: true\n    };\n  }\n\n  static async create(orbitdb, options = {}) {\n    options = { ...options,\n      ...{\n        write: options.write || [orbitdb.identity.publicKey]\n      }\n    };\n    return new LegacyIPFSAccessController(orbitdb._ipfs, options);\n  }\n\n}\n\nmodule.exports = LegacyIPFSAccessController;","map":{"version":3,"sources":["/home/samkuhlmann/Documents/ody/moloch/moloch-dao-badges/node_modules/orbit-db-access-controllers/src/legacy-ipfs-access-controller.js"],"names":["io","require","Buffer","AccessController","type","LegacyIPFSAccessController","constructor","ipfs","options","_ipfs","_write","Array","from","write","canAppend","entry","identityProvider","publicKey","key","includes","load","address","indexOf","split","access","read","e","console","log","save","cid","admin","JSON","stringify","format","skipManifest","create","orbitdb","identity","module","exports"],"mappings":"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","sourcesContent":["'use strict'\nconst io = require('orbit-db-io')\nconst Buffer = require('safe-buffer/').Buffer\nconst AccessController = require('./access-controller-interface')\nconst type = 'legacy-ipfs'\n\nclass LegacyIPFSAccessController extends AccessController {\n  constructor (ipfs, options) {\n    super()\n    this._ipfs = ipfs\n    this._write = Array.from(options.write || [])\n  }\n\n  // Returns the type of the access controller\n  static get type () { return type }\n\n  // Return a Set of keys that have `access` capability\n  get write () {\n    return this._write\n  }\n\n  async canAppend (entry, identityProvider) {\n    // Allow if access list contain the writer's publicKey or is '*'\n    const publicKey = entry.key\n    if (this.write.includes(publicKey) ||\n      this.write.includes('*')) {\n      return true\n    }\n    return false\n  }\n\n  async load (address) {\n    // Transform '/ipfs/QmPFtHi3cmfZerxtH9ySLdzpg1yFhocYDZgEZywdUXHxFU'\n    // to 'QmPFtHi3cmfZerxtH9ySLdzpg1yFhocYDZgEZywdUXHxFU'\n    if (address.indexOf('/ipfs') === 0) { address = address.split('/')[2] }\n\n    try {\n      const access = await io.read(this._ipfs, address)\n      this._write = access.write\n    } catch (e) {\n      console.log('LegacyIPFSAccessController.load ERROR:', e)\n    }\n  }\n\n  async save (options) {\n    let cid\n    const access = { admin: [], write: this.write, read: [] }\n    try {\n      cid = await io.write(this._ipfs, 'raw', Buffer.from(JSON.stringify(access, null, 2)), { format: 'dag-pb' })\n    } catch (e) {\n      console.log('LegacyIPFSAccessController.save ERROR:', e)\n    }\n    // return the manifest data\n    return { address: cid, skipManifest: true }\n  }\n\n  static async create (orbitdb, options = {}) {\n    options = { ...options, ...{ write: options.write || [orbitdb.identity.publicKey] } }\n    return new LegacyIPFSAccessController(orbitdb._ipfs, options)\n  }\n}\n\nmodule.exports = LegacyIPFSAccessController\n"]},"metadata":{},"sourceType":"script"}