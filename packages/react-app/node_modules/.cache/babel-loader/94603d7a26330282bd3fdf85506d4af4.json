{"ast":null,"code":"'use strict';\n\nconst mortice = require('mortice');\n\nlet lock;\n\nmodule.exports = repoOwner => {\n  if (lock) {\n    return lock;\n  }\n\n  const mutex = mortice({\n    // ordinarily the main thread would store the read/write lock but\n    // if we are the thread that owns the repo, we can store the lock\n    // on this process even if we are a worker thread\n    singleProcess: repoOwner\n  });\n  lock = {\n    readLock: func => {\n      return async (...args) => {\n        const releaseLock = await mutex.readLock();\n\n        try {\n          return await func.apply(null, args);\n        } finally {\n          releaseLock();\n        }\n      };\n    },\n    writeLock: func => {\n      return async (...args) => {\n        const releaseLock = await mutex.writeLock();\n\n        try {\n          return await func.apply(null, args);\n        } finally {\n          releaseLock();\n        }\n      };\n    }\n  };\n  return lock;\n};","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/ipfs-mfs/src/core/utils/create-lock.js"],"names":["mortice","require","lock","module","exports","repoOwner","mutex","singleProcess","readLock","func","args","releaseLock","apply","writeLock"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AAEA,IAAIC,IAAJ;;AAEAC,MAAM,CAACC,OAAP,GAAkBC,SAAD,IAAe;AAC9B,MAAIH,IAAJ,EAAU;AACR,WAAOA,IAAP;AACD;;AAED,QAAMI,KAAK,GAAGN,OAAO,CAAC;AACpB;AACA;AACA;AACAO,IAAAA,aAAa,EAAEF;AAJK,GAAD,CAArB;AAOAH,EAAAA,IAAI,GAAG;AACLM,IAAAA,QAAQ,EAAGC,IAAD,IAAU;AAClB,aAAO,OAAO,GAAGC,IAAV,KAAmB;AACxB,cAAMC,WAAW,GAAG,MAAML,KAAK,CAACE,QAAN,EAA1B;;AAEA,YAAI;AACF,iBAAO,MAAMC,IAAI,CAACG,KAAL,CAAW,IAAX,EAAiBF,IAAjB,CAAb;AACD,SAFD,SAEU;AACRC,UAAAA,WAAW;AACZ;AACF,OARD;AASD,KAXI;AAaLE,IAAAA,SAAS,EAAGJ,IAAD,IAAU;AACnB,aAAO,OAAO,GAAGC,IAAV,KAAmB;AACxB,cAAMC,WAAW,GAAG,MAAML,KAAK,CAACO,SAAN,EAA1B;;AAEA,YAAI;AACF,iBAAO,MAAMJ,IAAI,CAACG,KAAL,CAAW,IAAX,EAAiBF,IAAjB,CAAb;AACD,SAFD,SAEU;AACRC,UAAAA,WAAW;AACZ;AACF,OARD;AASD;AAvBI,GAAP;AA0BA,SAAOT,IAAP;AACD,CAvCD","sourcesContent":["'use strict'\n\nconst mortice = require('mortice')\n\nlet lock\n\nmodule.exports = (repoOwner) => {\n  if (lock) {\n    return lock\n  }\n\n  const mutex = mortice({\n    // ordinarily the main thread would store the read/write lock but\n    // if we are the thread that owns the repo, we can store the lock\n    // on this process even if we are a worker thread\n    singleProcess: repoOwner\n  })\n\n  lock = {\n    readLock: (func) => {\n      return async (...args) => {\n        const releaseLock = await mutex.readLock()\n\n        try {\n          return await func.apply(null, args)\n        } finally {\n          releaseLock()\n        }\n      }\n    },\n\n    writeLock: (func) => {\n      return async (...args) => {\n        const releaseLock = await mutex.writeLock()\n\n        try {\n          return await func.apply(null, args)\n        } finally {\n          releaseLock()\n        }\n      }\n    }\n  }\n\n  return lock\n}\n"]},"metadata":{},"sourceType":"script"}