{"ast":null,"code":"const CID = require('cids');\n\nconst dagPB = require('ipld-dag-pb');\n\nconst defaultBase = 'base58btc';\n\nconst cidifyString = str => {\n  if (!str) {\n    return str;\n  }\n\n  if (Array.isArray(str)) {\n    return str.map(cidifyString);\n  }\n\n  return new CID(str);\n};\n\nconst stringifyCid = (cid, options) => {\n  if (!cid || typeof cid === 'string') {\n    return cid;\n  }\n\n  if (Array.isArray(cid)) {\n    return cid.map(stringifyCid);\n  }\n\n  if (cid['/']) {\n    return cid['/'];\n  }\n\n  const base = options.base || defaultBase;\n  return cid.toBaseEncodedString(base);\n};\n\nconst writePb = async (ipfs, obj, options) => {\n  const buffer = Buffer.from(JSON.stringify(obj));\n  const dagNode = new dagPB.DAGNode(buffer);\n  const cid = await ipfs.dag.put(dagNode, {\n    format: 'dag-pb',\n    hashAlg: 'sha2-256'\n  });\n  const res = cid.toV0().toBaseEncodedString();\n  const pin = options.pin || false;\n\n  if (pin) {\n    await ipfs.pin.add(res);\n  }\n\n  return res;\n};\n\nconst readPb = async (ipfs, cid) => {\n  const result = await ipfs.dag.get(cid);\n  const dagNode = result.value;\n  return JSON.parse(dagNode.toJSON().data);\n};\n\nconst writeCbor = async (ipfs, obj, options) => {\n  const dagNode = Object.assign({}, obj);\n  const links = options.links || [];\n  links.forEach(prop => {\n    if (dagNode[prop]) {\n      dagNode[prop] = cidifyString(dagNode[prop]);\n    }\n  });\n  const base = options.base || defaultBase;\n  const onlyHash = options.onlyHash || false;\n  const cid = await ipfs.dag.put(dagNode, {\n    onlyHash\n  });\n  const res = cid.toBaseEncodedString(base);\n  const pin = options.pin || false;\n\n  if (pin) {\n    await ipfs.pin.add(res);\n  }\n\n  return res;\n};\n\nconst readCbor = async (ipfs, cid, options) => {\n  const result = await ipfs.dag.get(cid);\n  const obj = result.value;\n  const links = options.links || [];\n  links.forEach(prop => {\n    if (obj[prop]) {\n      obj[prop] = stringifyCid(obj[prop], options);\n    }\n  });\n  return obj;\n};\n\nconst writeObj = async (ipfs, obj, options) => {\n  const onlyHash = options.onlyHash || false;\n  const base = options.base || defaultBase;\n  const opts = Object.assign({}, {\n    onlyHash: onlyHash\n  }, options.format ? {\n    format: options.format,\n    hashAlg: 'sha2-256'\n  } : {});\n\n  if (opts.format === 'dag-pb') {\n    obj = new dagPB.DAGNode(obj);\n  }\n\n  const cid = await ipfs.dag.put(obj, opts);\n  const res = cid.toBaseEncodedString(base);\n  const pin = options.pin || false;\n\n  if (pin) {\n    await ipfs.pin.add(res);\n  }\n\n  return res;\n};\n\nconst formats = {\n  'dag-pb': {\n    read: readPb,\n    write: writePb\n  },\n  'dag-cbor': {\n    write: writeCbor,\n    read: readCbor\n  },\n  'raw': {\n    write: writeObj\n  }\n};\n\nconst write = (ipfs, codec, obj, options = {}) => {\n  const format = formats[codec];\n  if (!format) throw new Error('Unsupported codec');\n  return format.write(ipfs, obj, options);\n};\n\nconst read = (ipfs, cid, options = {}) => {\n  cid = new CID(cid);\n  const format = formats[cid.codec];\n  if (!format) throw new Error('Unsupported codec');\n  return format.read(ipfs, cid, options);\n};\n\nmodule.exports = {\n  read,\n  write\n};","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/orbit-db-io/index.js"],"names":["CID","require","dagPB","defaultBase","cidifyString","str","Array","isArray","map","stringifyCid","cid","options","base","toBaseEncodedString","writePb","ipfs","obj","buffer","Buffer","from","JSON","stringify","dagNode","DAGNode","dag","put","format","hashAlg","res","toV0","pin","add","readPb","result","get","value","parse","toJSON","data","writeCbor","Object","assign","links","forEach","prop","onlyHash","readCbor","writeObj","opts","formats","read","write","codec","Error","module","exports"],"mappings":"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","sourcesContent":["const CID = require('cids')\nconst dagPB = require('ipld-dag-pb')\nconst defaultBase = 'base58btc'\n\nconst cidifyString = (str) => {\n  if (!str) {\n    return str\n  }\n\n  if (Array.isArray(str)) {\n    return str.map(cidifyString)\n  }\n\n  return new CID(str)\n}\n\nconst stringifyCid = (cid, options) => {\n  if (!cid || typeof cid === 'string') {\n    return cid\n  }\n\n  if (Array.isArray(cid)) {\n    return cid.map(stringifyCid)\n  }\n\n  if (cid['/']) {\n    return cid['/']\n  }\n\n  const base = options.base || defaultBase\n  return cid.toBaseEncodedString(base)\n}\n\nconst writePb = async (ipfs, obj, options) => {\n  const buffer = Buffer.from(JSON.stringify(obj))\n  const dagNode = new dagPB.DAGNode(buffer)\n  const cid = await ipfs.dag.put(dagNode, {\n    format: 'dag-pb',\n    hashAlg: 'sha2-256'\n  })\n\n  const res = cid.toV0().toBaseEncodedString()\n  const pin = options.pin || false\n  if (pin) {\n    await ipfs.pin.add(res)\n  }\n\n  return res\n}\n\nconst readPb = async (ipfs, cid) => {\n  const result = await ipfs.dag.get(cid)\n  const dagNode = result.value\n\n  return JSON.parse(dagNode.toJSON().data)\n}\n\nconst writeCbor = async (ipfs, obj, options) => {\n  const dagNode = Object.assign({}, obj)\n  const links = options.links || []\n  links.forEach((prop) => {\n    if (dagNode[prop]) {\n      dagNode[prop] = cidifyString(dagNode[prop])\n    }\n  })\n\n  const base = options.base || defaultBase\n  const onlyHash = options.onlyHash || false\n  const cid = await ipfs.dag.put(dagNode, { onlyHash })\n  const res = cid.toBaseEncodedString(base)\n  const pin = options.pin || false\n  if (pin) {\n    await ipfs.pin.add(res)\n  }\n  return res\n}\n\nconst readCbor = async (ipfs, cid, options) => {\n  const result = await ipfs.dag.get(cid)\n  const obj = result.value\n  const links = options.links || []\n  links.forEach((prop) => {\n    if (obj[prop]) {\n      obj[prop] = stringifyCid(obj[prop], options)\n    }\n  })\n\n  return obj\n}\n\nconst writeObj = async (ipfs, obj, options) => {\n  const onlyHash = options.onlyHash || false\n  const base = options.base || defaultBase\n  const opts = Object.assign({}, { onlyHash: onlyHash }, options.format ? { format: options.format, hashAlg: 'sha2-256' } : {})\n  if (opts.format === 'dag-pb') {\n    obj = new dagPB.DAGNode(obj)\n  }\n\n  const cid = await ipfs.dag.put(obj, opts)\n  const res = cid.toBaseEncodedString(base)\n  const pin = options.pin || false\n  if (pin) {\n    await ipfs.pin.add(res)\n  }\n  return res\n}\n\nconst formats = {\n  'dag-pb': { read: readPb, write: writePb },\n  'dag-cbor': { write: writeCbor, read: readCbor },\n  'raw': { write: writeObj }\n}\n\nconst write = (ipfs, codec, obj, options = {}) => {\n  const format = formats[codec]\n  if (!format) throw new Error('Unsupported codec')\n\n  return format.write(ipfs, obj, options)\n}\n\nconst read = (ipfs, cid, options = {}) => {\n  cid = new CID(cid)\n  const format = formats[cid.codec]\n\n  if (!format) throw new Error('Unsupported codec')\n\n  return format.read(ipfs, cid, options)\n}\n\nmodule.exports = {\n  read,\n  write\n}\n"]},"metadata":{},"sourceType":"script"}