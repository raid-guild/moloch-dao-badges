{"ast":null,"code":"/* Copyright (c) 2017 Rod Vagg, MIT License */\nvar xtend = require('xtend'),\n    AbstractIterator = require('./abstract-iterator'),\n    AbstractChainedBatch = require('./abstract-chained-batch');\n\nfunction AbstractLevelDOWN(location) {\n  if (!arguments.length || location === undefined) throw new Error('constructor requires at least a location argument');\n  if (typeof location != 'string') throw new Error('constructor requires a location string argument');\n  this.location = location;\n  this.status = 'new';\n}\n\nAbstractLevelDOWN.prototype.open = function (options, callback) {\n  var self = this,\n      oldStatus = this.status;\n  if (typeof options == 'function') callback = options;\n  if (typeof callback != 'function') throw new Error('open() requires a callback argument');\n  if (typeof options != 'object') options = {};\n  options.createIfMissing = options.createIfMissing != false;\n  options.errorIfExists = !!options.errorIfExists;\n\n  if (typeof this._open == 'function') {\n    this.status = 'opening';\n\n    this._open(options, function (err) {\n      if (err) {\n        self.status = oldStatus;\n        return callback(err);\n      }\n\n      self.status = 'open';\n      callback();\n    });\n  } else {\n    this.status = 'open';\n    process.nextTick(callback);\n  }\n};\n\nAbstractLevelDOWN.prototype.close = function (callback) {\n  var self = this,\n      oldStatus = this.status;\n  if (typeof callback != 'function') throw new Error('close() requires a callback argument');\n\n  if (typeof this._close == 'function') {\n    this.status = 'closing';\n\n    this._close(function (err) {\n      if (err) {\n        self.status = oldStatus;\n        return callback(err);\n      }\n\n      self.status = 'closed';\n      callback();\n    });\n  } else {\n    this.status = 'closed';\n    process.nextTick(callback);\n  }\n};\n\nAbstractLevelDOWN.prototype.get = function (key, options, callback) {\n  var err;\n  if (typeof options == 'function') callback = options;\n  if (typeof callback != 'function') throw new Error('get() requires a callback argument');\n  if (err = this._checkKey(key, 'key')) return callback(err);\n  key = this._serializeKey(key);\n  if (typeof options != 'object') options = {};\n  options.asBuffer = options.asBuffer != false;\n  if (typeof this._get == 'function') return this._get(key, options, callback);\n  process.nextTick(function () {\n    callback(new Error('NotFound'));\n  });\n};\n\nAbstractLevelDOWN.prototype.put = function (key, value, options, callback) {\n  var err;\n  if (typeof options == 'function') callback = options;\n  if (typeof callback != 'function') throw new Error('put() requires a callback argument');\n  if (err = this._checkKey(key, 'key')) return callback(err);\n  key = this._serializeKey(key);\n  value = this._serializeValue(value);\n  if (typeof options != 'object') options = {};\n  if (typeof this._put == 'function') return this._put(key, value, options, callback);\n  process.nextTick(callback);\n};\n\nAbstractLevelDOWN.prototype.del = function (key, options, callback) {\n  var err;\n  if (typeof options == 'function') callback = options;\n  if (typeof callback != 'function') throw new Error('del() requires a callback argument');\n  if (err = this._checkKey(key, 'key')) return callback(err);\n  key = this._serializeKey(key);\n  if (typeof options != 'object') options = {};\n  if (typeof this._del == 'function') return this._del(key, options, callback);\n  process.nextTick(callback);\n};\n\nAbstractLevelDOWN.prototype.batch = function (array, options, callback) {\n  if (!arguments.length) return this._chainedBatch();\n  if (typeof options == 'function') callback = options;\n  if (typeof array == 'function') callback = array;\n  if (typeof callback != 'function') throw new Error('batch(array) requires a callback argument');\n  if (!Array.isArray(array)) return callback(new Error('batch(array) requires an array argument'));\n  if (!options || typeof options != 'object') options = {};\n  var i = 0,\n      l = array.length,\n      e,\n      err;\n\n  for (; i < l; i++) {\n    e = array[i];\n    if (typeof e != 'object') continue;\n    if (err = this._checkKey(e.type, 'type')) return callback(err);\n    if (err = this._checkKey(e.key, 'key')) return callback(err);\n  }\n\n  if (typeof this._batch == 'function') return this._batch(array, options, callback);\n  process.nextTick(callback);\n}; //TODO: remove from here, not a necessary primitive\n\n\nAbstractLevelDOWN.prototype.approximateSize = function (start, end, callback) {\n  if (start == null || end == null || typeof start == 'function' || typeof end == 'function') {\n    throw new Error('approximateSize() requires valid `start`, `end` and `callback` arguments');\n  }\n\n  if (typeof callback != 'function') throw new Error('approximateSize() requires a callback argument');\n  start = this._serializeKey(start);\n  end = this._serializeKey(end);\n  if (typeof this._approximateSize == 'function') return this._approximateSize(start, end, callback);\n  process.nextTick(function () {\n    callback(null, 0);\n  });\n};\n\nAbstractLevelDOWN.prototype._setupIteratorOptions = function (options) {\n  var self = this;\n  options = xtend(options);\n  ['start', 'end', 'gt', 'gte', 'lt', 'lte'].forEach(function (o) {\n    if (options[o] && self._isBuffer(options[o]) && options[o].length === 0) delete options[o];\n  });\n  options.reverse = !!options.reverse;\n  options.keys = options.keys != false;\n  options.values = options.values != false;\n  options.limit = 'limit' in options ? options.limit : -1;\n  options.keyAsBuffer = options.keyAsBuffer != false;\n  options.valueAsBuffer = options.valueAsBuffer != false;\n  return options;\n};\n\nAbstractLevelDOWN.prototype.iterator = function (options) {\n  if (typeof options != 'object') options = {};\n  options = this._setupIteratorOptions(options);\n  if (typeof this._iterator == 'function') return this._iterator(options);\n  return new AbstractIterator(this);\n};\n\nAbstractLevelDOWN.prototype._chainedBatch = function () {\n  return new AbstractChainedBatch(this);\n};\n\nAbstractLevelDOWN.prototype._isBuffer = function (obj) {\n  return Buffer.isBuffer(obj);\n};\n\nAbstractLevelDOWN.prototype._serializeKey = function (key) {\n  return this._isBuffer(key) ? key : String(key);\n};\n\nAbstractLevelDOWN.prototype._serializeValue = function (value) {\n  if (value == null) return '';\n  return this._isBuffer(value) || process.browser ? value : String(value);\n};\n\nAbstractLevelDOWN.prototype._checkKey = function (obj, type) {\n  if (obj === null || obj === undefined) return new Error(type + ' cannot be `null` or `undefined`');\n  if (this._isBuffer(obj) && obj.length === 0) return new Error(type + ' cannot be an empty Buffer');else if (String(obj) === '') return new Error(type + ' cannot be an empty String');\n};\n\nmodule.exports = AbstractLevelDOWN;","map":{"version":3,"sources":["/home/samkuhlmann/Documents/ody/moloch/moloch-dao-badges/node_modules/deferred-leveldown/node_modules/abstract-leveldown/abstract-leveldown.js"],"names":["xtend","require","AbstractIterator","AbstractChainedBatch","AbstractLevelDOWN","location","arguments","length","undefined","Error","status","prototype","open","options","callback","self","oldStatus","createIfMissing","errorIfExists","_open","err","process","nextTick","close","_close","get","key","_checkKey","_serializeKey","asBuffer","_get","put","value","_serializeValue","_put","del","_del","batch","array","_chainedBatch","Array","isArray","i","l","e","type","_batch","approximateSize","start","end","_approximateSize","_setupIteratorOptions","forEach","o","_isBuffer","reverse","keys","values","limit","keyAsBuffer","valueAsBuffer","iterator","_iterator","obj","Buffer","isBuffer","String","browser","module","exports"],"mappings":"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","sourcesContent":["/* Copyright (c) 2017 Rod Vagg, MIT License */\n\nvar xtend                = require('xtend')\n  , AbstractIterator     = require('./abstract-iterator')\n  , AbstractChainedBatch = require('./abstract-chained-batch')\n\nfunction AbstractLevelDOWN (location) {\n  if (!arguments.length || location === undefined)\n    throw new Error('constructor requires at least a location argument')\n\n  if (typeof location != 'string')\n    throw new Error('constructor requires a location string argument')\n\n  this.location = location\n  this.status = 'new'\n}\n\nAbstractLevelDOWN.prototype.open = function (options, callback) {\n  var self      = this\n    , oldStatus = this.status\n\n  if (typeof options == 'function')\n    callback = options\n\n  if (typeof callback != 'function')\n    throw new Error('open() requires a callback argument')\n\n  if (typeof options != 'object')\n    options = {}\n\n  options.createIfMissing = options.createIfMissing != false\n  options.errorIfExists = !!options.errorIfExists\n\n  if (typeof this._open == 'function') {\n    this.status = 'opening'\n    this._open(options, function (err) {\n      if (err) {\n        self.status = oldStatus\n        return callback(err)\n      }\n      self.status = 'open'\n      callback()\n    })\n  } else {\n    this.status = 'open'\n    process.nextTick(callback)\n  }\n}\n\nAbstractLevelDOWN.prototype.close = function (callback) {\n  var self      = this\n    , oldStatus = this.status\n\n  if (typeof callback != 'function')\n    throw new Error('close() requires a callback argument')\n\n  if (typeof this._close == 'function') {\n    this.status = 'closing'\n    this._close(function (err) {\n      if (err) {\n        self.status = oldStatus\n        return callback(err)\n      }\n      self.status = 'closed'\n      callback()\n    })\n  } else {\n    this.status = 'closed'\n    process.nextTick(callback)\n  }\n}\n\nAbstractLevelDOWN.prototype.get = function (key, options, callback) {\n  var err\n\n  if (typeof options == 'function')\n    callback = options\n\n  if (typeof callback != 'function')\n    throw new Error('get() requires a callback argument')\n\n  if (err = this._checkKey(key, 'key'))\n    return callback(err)\n\n  key = this._serializeKey(key)\n\n  if (typeof options != 'object')\n    options = {}\n\n  options.asBuffer = options.asBuffer != false\n\n  if (typeof this._get == 'function')\n    return this._get(key, options, callback)\n\n  process.nextTick(function () { callback(new Error('NotFound')) })\n}\n\nAbstractLevelDOWN.prototype.put = function (key, value, options, callback) {\n  var err\n\n  if (typeof options == 'function')\n    callback = options\n\n  if (typeof callback != 'function')\n    throw new Error('put() requires a callback argument')\n\n  if (err = this._checkKey(key, 'key'))\n    return callback(err)\n\n  key = this._serializeKey(key)\n  value = this._serializeValue(value)\n\n  if (typeof options != 'object')\n    options = {}\n\n  if (typeof this._put == 'function')\n    return this._put(key, value, options, callback)\n\n  process.nextTick(callback)\n}\n\nAbstractLevelDOWN.prototype.del = function (key, options, callback) {\n  var err\n\n  if (typeof options == 'function')\n    callback = options\n\n  if (typeof callback != 'function')\n    throw new Error('del() requires a callback argument')\n\n  if (err = this._checkKey(key, 'key'))\n    return callback(err)\n\n  key = this._serializeKey(key)\n\n  if (typeof options != 'object')\n    options = {}\n\n  if (typeof this._del == 'function')\n    return this._del(key, options, callback)\n\n  process.nextTick(callback)\n}\n\nAbstractLevelDOWN.prototype.batch = function (array, options, callback) {\n  if (!arguments.length)\n    return this._chainedBatch()\n\n  if (typeof options == 'function')\n    callback = options\n\n  if (typeof array == 'function')\n    callback = array\n\n  if (typeof callback != 'function')\n    throw new Error('batch(array) requires a callback argument')\n\n  if (!Array.isArray(array))\n    return callback(new Error('batch(array) requires an array argument'))\n\n  if (!options || typeof options != 'object')\n    options = {}\n\n  var i = 0\n    , l = array.length\n    , e\n    , err\n\n  for (; i < l; i++) {\n    e = array[i]\n    if (typeof e != 'object')\n      continue\n\n    if (err = this._checkKey(e.type, 'type'))\n      return callback(err)\n\n    if (err = this._checkKey(e.key, 'key'))\n      return callback(err)\n  }\n\n  if (typeof this._batch == 'function')\n    return this._batch(array, options, callback)\n\n  process.nextTick(callback)\n}\n\n//TODO: remove from here, not a necessary primitive\nAbstractLevelDOWN.prototype.approximateSize = function (start, end, callback) {\n  if (   start == null\n      || end == null\n      || typeof start == 'function'\n      || typeof end == 'function') {\n    throw new Error('approximateSize() requires valid `start`, `end` and `callback` arguments')\n  }\n\n  if (typeof callback != 'function')\n    throw new Error('approximateSize() requires a callback argument')\n\n  start = this._serializeKey(start)\n  end = this._serializeKey(end)\n\n  if (typeof this._approximateSize == 'function')\n    return this._approximateSize(start, end, callback)\n\n  process.nextTick(function () {\n    callback(null, 0)\n  })\n}\n\nAbstractLevelDOWN.prototype._setupIteratorOptions = function (options) {\n  var self = this\n\n  options = xtend(options)\n\n  ;[ 'start', 'end', 'gt', 'gte', 'lt', 'lte' ].forEach(function (o) {\n    if (options[o] && self._isBuffer(options[o]) && options[o].length === 0)\n      delete options[o]\n  })\n\n  options.reverse = !!options.reverse\n  options.keys = options.keys != false\n  options.values = options.values != false\n  options.limit = 'limit' in options ? options.limit : -1\n  options.keyAsBuffer = options.keyAsBuffer != false\n  options.valueAsBuffer = options.valueAsBuffer != false\n\n  return options\n}\n\nAbstractLevelDOWN.prototype.iterator = function (options) {\n  if (typeof options != 'object')\n    options = {}\n\n  options = this._setupIteratorOptions(options)\n\n  if (typeof this._iterator == 'function')\n    return this._iterator(options)\n\n  return new AbstractIterator(this)\n}\n\nAbstractLevelDOWN.prototype._chainedBatch = function () {\n  return new AbstractChainedBatch(this)\n}\n\nAbstractLevelDOWN.prototype._isBuffer = function (obj) {\n  return Buffer.isBuffer(obj)\n}\n\nAbstractLevelDOWN.prototype._serializeKey = function (key) {\n  return this._isBuffer(key)\n    ? key\n    : String(key)\n}\n\nAbstractLevelDOWN.prototype._serializeValue = function (value) {\n  if (value == null) return ''\n  return this._isBuffer(value) || process.browser ? value : String(value)\n}\n\nAbstractLevelDOWN.prototype._checkKey = function (obj, type) {\n  if (obj === null || obj === undefined)\n    return new Error(type + ' cannot be `null` or `undefined`')\n\n  if (this._isBuffer(obj) && obj.length === 0)\n    return new Error(type + ' cannot be an empty Buffer')\n  else if (String(obj) === '')\n    return new Error(type + ' cannot be an empty String')\n}\n\nmodule.exports = AbstractLevelDOWN\n"]},"metadata":{},"sourceType":"script"}