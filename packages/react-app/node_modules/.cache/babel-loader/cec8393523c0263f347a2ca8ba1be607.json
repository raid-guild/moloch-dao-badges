{"ast":null,"code":"var AbstractLevelDOWN = require('abstract-leveldown').AbstractLevelDOWN;\n\nvar inherits = require('inherits');\n\nvar DeferredIterator = require('./deferred-iterator');\n\nvar deferrables = 'put get del batch clear'.split(' ');\nvar optionalDeferrables = 'approximateSize compactRange'.split(' ');\n\nfunction DeferredLevelDOWN(db) {\n  AbstractLevelDOWN.call(this, db.supports || {}); // TODO (future major): remove this fallback; db must have manifest that\n  // declares approximateSize and compactRange in additionalMethods.\n\n  optionalDeferrables.forEach(function (m) {\n    if (typeof db[m] === 'function' && !this.supports.additionalMethods[m]) {\n      this.supports.additionalMethods[m] = true;\n    }\n  }, this);\n  this._db = db;\n  this._operations = [];\n  closed(this);\n}\n\ninherits(DeferredLevelDOWN, AbstractLevelDOWN);\nDeferredLevelDOWN.prototype.type = 'deferred-leveldown';\n\nDeferredLevelDOWN.prototype._open = function (options, callback) {\n  var self = this;\n\n  this._db.open(options, function (err) {\n    if (err) return callback(err);\n\n    self._operations.forEach(function (op) {\n      if (op.iterator) {\n        op.iterator.setDb(self._db);\n      } else {\n        self._db[op.method].apply(self._db, op.args);\n      }\n    });\n\n    self._operations = [];\n    open(self);\n    callback();\n  });\n};\n\nDeferredLevelDOWN.prototype._close = function (callback) {\n  var self = this;\n\n  this._db.close(function (err) {\n    if (err) return callback(err);\n    closed(self);\n    callback();\n  });\n};\n\nfunction open(self) {\n  deferrables.concat('iterator').forEach(function (m) {\n    self['_' + m] = function () {\n      return this._db[m].apply(this._db, arguments);\n    };\n  });\n  Object.keys(self.supports.additionalMethods).forEach(function (m) {\n    self[m] = function () {\n      return this._db[m].apply(this._db, arguments);\n    };\n  });\n}\n\nfunction closed(self) {\n  deferrables.forEach(function (m) {\n    self['_' + m] = function () {\n      this._operations.push({\n        method: m,\n        args: arguments\n      });\n    };\n  });\n  Object.keys(self.supports.additionalMethods).forEach(function (m) {\n    self[m] = function () {\n      this._operations.push({\n        method: m,\n        args: arguments\n      });\n    };\n  });\n\n  self._iterator = function (options) {\n    var it = new DeferredIterator(self, options);\n\n    this._operations.push({\n      iterator: it\n    });\n\n    return it;\n  };\n}\n\nDeferredLevelDOWN.prototype._serializeKey = function (key) {\n  return key;\n};\n\nDeferredLevelDOWN.prototype._serializeValue = function (value) {\n  return value;\n};\n\nmodule.exports = DeferredLevelDOWN;\nmodule.exports.DeferredIterator = DeferredIterator;","map":{"version":3,"sources":["/home/dekan/Projects/raid-guild/dao-badges-web/node_modules/level-packager/node_modules/deferred-leveldown/deferred-leveldown.js"],"names":["AbstractLevelDOWN","require","inherits","DeferredIterator","deferrables","split","optionalDeferrables","DeferredLevelDOWN","db","call","supports","forEach","m","additionalMethods","_db","_operations","closed","prototype","type","_open","options","callback","self","open","err","op","iterator","setDb","method","apply","args","_close","close","concat","arguments","Object","keys","push","_iterator","it","_serializeKey","key","_serializeValue","value","module","exports"],"mappings":"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","sourcesContent":["var AbstractLevelDOWN = require('abstract-leveldown').AbstractLevelDOWN\nvar inherits = require('inherits')\nvar DeferredIterator = require('./deferred-iterator')\nvar deferrables = 'put get del batch clear'.split(' ')\nvar optionalDeferrables = 'approximateSize compactRange'.split(' ')\n\nfunction DeferredLevelDOWN (db) {\n  AbstractLevelDOWN.call(this, db.supports || {})\n\n  // TODO (future major): remove this fallback; db must have manifest that\n  // declares approximateSize and compactRange in additionalMethods.\n  optionalDeferrables.forEach(function (m) {\n    if (typeof db[m] === 'function' && !this.supports.additionalMethods[m]) {\n      this.supports.additionalMethods[m] = true\n    }\n  }, this)\n\n  this._db = db\n  this._operations = []\n  closed(this)\n}\n\ninherits(DeferredLevelDOWN, AbstractLevelDOWN)\n\nDeferredLevelDOWN.prototype.type = 'deferred-leveldown'\n\nDeferredLevelDOWN.prototype._open = function (options, callback) {\n  var self = this\n\n  this._db.open(options, function (err) {\n    if (err) return callback(err)\n\n    self._operations.forEach(function (op) {\n      if (op.iterator) {\n        op.iterator.setDb(self._db)\n      } else {\n        self._db[op.method].apply(self._db, op.args)\n      }\n    })\n    self._operations = []\n\n    open(self)\n    callback()\n  })\n}\n\nDeferredLevelDOWN.prototype._close = function (callback) {\n  var self = this\n\n  this._db.close(function (err) {\n    if (err) return callback(err)\n    closed(self)\n    callback()\n  })\n}\n\nfunction open (self) {\n  deferrables.concat('iterator').forEach(function (m) {\n    self['_' + m] = function () {\n      return this._db[m].apply(this._db, arguments)\n    }\n  })\n  Object.keys(self.supports.additionalMethods).forEach(function (m) {\n    self[m] = function () {\n      return this._db[m].apply(this._db, arguments)\n    }\n  })\n}\n\nfunction closed (self) {\n  deferrables.forEach(function (m) {\n    self['_' + m] = function () {\n      this._operations.push({ method: m, args: arguments })\n    }\n  })\n  Object.keys(self.supports.additionalMethods).forEach(function (m) {\n    self[m] = function () {\n      this._operations.push({ method: m, args: arguments })\n    }\n  })\n  self._iterator = function (options) {\n    var it = new DeferredIterator(self, options)\n    this._operations.push({ iterator: it })\n    return it\n  }\n}\n\nDeferredLevelDOWN.prototype._serializeKey = function (key) {\n  return key\n}\n\nDeferredLevelDOWN.prototype._serializeValue = function (value) {\n  return value\n}\n\nmodule.exports = DeferredLevelDOWN\nmodule.exports.DeferredIterator = DeferredIterator\n"]},"metadata":{},"sourceType":"script"}